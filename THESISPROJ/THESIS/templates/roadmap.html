<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roadmap</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/roadmap.css') }}" />
</head>
<body>
  <div class="roadmap-wrapper">
    <div class="roadmap-content">
      <!-- Background Image -->
      <img src="{{ url_for('static', filename='images/gameimg/roadmap/roadmap.png') }}" alt="Roadmap" class="bg-img" />

      <!-- Image-Based Buttons -->
      <div class="roadmap-buttons">
        <!-- Back Button -->
        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('dashboard') }}">
            <button class="back-btn"></button>
          </a>
        </div>

        <!-- Map Buttons -->
        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='addition') }}" class="roadmap-btn addition-village" data-map="addition"></a>
        </div>
        <div class="star-wrapper addition-village-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='subtraction') }}" class="roadmap-btn subtraction-sands" data-map="subtraction"></a>
        </div>
        <div class="star-wrapper subtraction-sands-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='comparison') }}" class="roadmap-btn comparison-cliffs" data-map="comparison"></a>
        </div>
        <div class="star-wrapper comparison-cliffs-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='placevalue') }}" class="roadmap-btn place-value-town" data-map="placevalue"></a>
        </div>
        <div class="star-wrapper place-value-town-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='multiplication') }}" class="roadmap-btn multiplication-mirage" data-map="multiplication"></a>
        </div>
        <div class="star-wrapper multiplication-mirage-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='division') }}" class="roadmap-btn division-river" data-map="division"></a>
        </div>
        <div class="star-wrapper division-river-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='numerals') }}" class="roadmap-btn numeral-ruins" data-map="numerals"></a>
        </div>
        <div class="star-wrapper numeral-ruins-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>

        <div class="roadmap-btn-wrapper">
          <a href="{{ url_for('stages', map='counting') }}" class="roadmap-btn counting-springs" data-map="counting"></a>
        </div>
        <div class="star-wrapper counting-springs-stars">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-1" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-2" alt="star">
          <img src="{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}" class="progress-star star-3" alt="star">
        </div>
      </div> <!-- .roadmap-buttons -->
    </div> <!-- .roadmap-content -->
  </div> <!-- .roadmap-wrapper -->

<!-- STAR PROGRESS SCRIPT -->
<script>
  const starFilled = "{{ url_for('static', filename='images/gameimg/roadmap/star-filled.png') }}";
  const starEmpty = "{{ url_for('static', filename='images/gameimg/roadmap/star-empty.png') }}";

  // Function to set stars for both roadmap and stages
  function setStars(wrapperSelector, mapPrefix, progress, stageCount = 3) {
    const wrapper = document.querySelector(wrapperSelector);
    if (!wrapper) return;

    const stars = wrapper.querySelectorAll('.progress-star');
    let totalStars = 0;

    // Loop through each stage and set star progress
    for (let i = 0; i < stageCount; i++) {
      const stageKey = `${mapPrefix}-${i + 1}`;
      const stageData = progress[stageKey];
      const starsEarned = (stageData && stageData.stars) || 0;

      totalStars += starsEarned;

      // Set stars for the current stage
      if (stars[i]) {
        stars[i].src = starsEarned > 0 ? starFilled : starEmpty;
      }
    }

    // Update overall stars for the map in the roadmap (max 3 stars per map)
    const mapProgress = document.querySelector(`.${mapPrefix}-progress`);
    if (mapProgress) {
      const totalMapStars = Math.min(totalStars, 3); // max 3 stars per map
      mapProgress.src = totalMapStars === 3 ? starFilled : (totalMapStars > 0 ? starEmpty : starFilled);
    }
  }

  // List of map wrappers and their prefixes
  const maps = [
    ['.addition-village-stars', 'addition'],
    ['.subtraction-sands-stars', 'subtraction'],
    ['.comparison-cliffs-stars', 'comparison'],
    ['.place-value-town-stars', 'placevalue'],
    ['.multiplication-mirage-stars', 'multiplication'],
    ['.division-river-stars', 'division'],
    ['.numeral-ruins-stars', 'numerals'],
    ['.counting-springs-stars', 'counting']
  ];

  // Fetch progress from server and update all maps
  fetch('/get_stage_progress')
    .then(response => response.json())
    .then(progress => {
      maps.forEach(([selector, prefix]) => {
        setStars(selector, prefix, progress);
      });
    })
    .catch(error => {
      console.error('Failed to load stage progress:', error);
    });
</script>







</body>
</html>
